# 🌸 花园种植游戏 — 策划文档

> 基于代码逻辑梳理，最后更新：2026-02-28

---

## 1. 游戏概述

一款 2D 休闲经营类移动端网页游戏。玩家在花棚中种植、浇水、收割花朵，通过完成采购任务和接受收购订单赚取金币，升级花朵品种以提升产量，解锁新花种并装饰花盆。

**技术栈**：Vite + React 18 + TypeScript，纯前端，数据持久化于 localStorage。

---

## 2. 核心玩法循环

```
播种 → 浇水 → 开花 → 收割 → 入库
                ↑ (冷却后再次开花)
                └── 多次收割 ──┘

入库 → 采购任务 / 收购订单 → 金币 + 经验
       ↓                      ↓
  花卉之魂掉落            升级花朵 / 解锁花种 / 购买皮肤
```

### 2.1 操作流程

1. **点击空花盆** → 弹出种子选择面板（仅显示当前等级已解锁的花种）
2. **选择种子** → 播种，花盆显示种子状态
3. **点击已播种花盆** → 弹出浇水面板，消耗 1 水量浇水
4. **浇水后** → 花朵立即进入 `blooming`（开花）状态
5. **点击开花花盆** → 收割，根据花朵等级获得对应产量，花朵入库
6. **多次收割** → 若 `harvestsRemaining > 0`，花盆进入冷却 → 冷却结束自动回到开花状态
7. **收割次数耗尽** → 花盆清空回到 `empty`

### 2.2 花盆状态机

```
empty → seeded → (浇水) → blooming → (收割)
                                        ├── harvestsRemaining > 0 → cooling → (冷却结束) → blooming
                                        └── harvestsRemaining = 0 → empty
```

| 状态 | 说明 | 可交互操作 |
|------|------|-----------|
| `empty` | 空花盆 | 播种 |
| `seeded` | 已播种 | 浇水 |
| `growing` | 生长中 | 浇水 |
| `blooming` | 开花 | 收割 |
| `cooling` | 冷却中（收割后） | 无（自动倒计时） |

---

## 3. 花盆网格

| 参数 | 值 |
|------|------|
| 列数 `GRID_COLS` | 4 |
| 行数 `GRID_ROWS` | 7 |
| 花盆总数 | 28 |

纵向排列，移动端可滑动查看。

---

## 4. 花朵品种

共 **10 种** 花朵，按玩家等级逐步解锁：

| 花朵 | ID | 基础售价 | 解锁等级 |
|------|------|---------|---------|
| 玫瑰 | `rose` | 5 | Lv.1 |
| 郁金香 | `tulip` | 5 | Lv.1 |
| 雏菊 | `daisy` | 5 | Lv.1 |
| 向日葵 | `sunflower` | 8 | Lv.2 |
| 薰衣草 | `lavender` | 8 | Lv.2 |
| 兰花 | `orchid` | 12 | Lv.3 |
| 牡丹 | `peony` | 12 | Lv.3 |
| 康乃馨 | `carnation` | 15 | Lv.4 |
| 菊花 | `chrysanthemum` | 15 | Lv.4 |
| 扶桑 | `hibiscus` | 20 | Lv.5 |

每种花朵有 4 个生长阶段图：seed → sprout → growing → bloom。

---

## 5. 货币系统

### 5.1 金币

| 参数 | 值 |
|------|------|
| 初始金币 | 0 |

**获取途径**：完成采购任务、接受收购订单。
**消耗途径**：升级花朵等级、购买花盆皮肤。

### 5.2 水量

| 参数 | 值 |
|------|------|
| 初始水量 | 100 |
| 水量上限 `MAX_WATER` | 100 |
| 每次浇水消耗 | 1 |
| 自动恢复间隔 | 10 秒 |
| 每次恢复量 | 1 |
| 水不足警告持续 | 2 秒 |

水量自动恢复，到上限停止。浇水时若水量不足，显示红色警告提示。

---

## 6. 花朵等级系统

每种花朵独立升级，共 **20 级**，分为 4 个阶段：

### 6.1 等级数值表

| 等级 | 收割次数 | 每次产量 | 冷却(秒) | 升级金币 | 升级魂 | 阶段 |
|------|---------|---------|----------|---------|--------|------|
| 1 | 1 | 1 | 0 | 50 | 1 | 基础 |
| 2 | 2 | 1 | 30 | 150 | 2 | 基础 |
| 3 | 2 | 2 | 25 | 300 | 3 | 基础 |
| 4 | 3 | 2 | 20 | 500 | 5 | 基础 |
| 5 | 3 | 3 | 18 | 800 | 7 | 基础 |
| 6 | 4 | 3 | 15 | 1,200 | 10 | 成长 |
| 7 | 4 | 3 | 12 | 1,800 | 13 | 成长 |
| 8 | 4 | 4 | 12 | 2,500 | 16 | 成长 |
| 9 | 5 | 4 | 10 | 3,500 | 20 | 成长 |
| 10 | 5 | 4 | 8 | 5,000 | 25 | 成长 |
| 11 | 5 | 5 | 8 | 7,000 | 30 | 精通 |
| 12 | 6 | 5 | 7 | 9,500 | 36 | 精通 |
| 13 | 6 | 5 | 6 | 12,000 | 42 | 精通 |
| 14 | 6 | 6 | 6 | 16,000 | 50 | 精通 |
| 15 | 7 | 6 | 5 | 20,000 | 58 | 精通 |
| 16 | 7 | 6 | 4 | 26,000 | 68 | 大师 |
| 17 | 7 | 7 | 4 | 33,000 | 80 | 大师 |
| 18 | 8 | 7 | 3 | 42,000 | 95 | 大师 |
| 19 | 8 | 8 | 2 | 55,000 | 115 | 大师 |
| 20 | 8 | 9 | 2 | — | — | 满级 |

- **收割次数**：一次播种可收割几次，收割后进入冷却再次开花
- **每次产量**：每次收割获得的花朵数量
- **冷却时间**：收割后到再次开花的等待秒数
- 升级需同时消耗 **金币** 和 **该品种的花卉之魂**

### 6.2 花卉之魂

| 参数 | 值 |
|------|------|
| 每次收割掉落概率 | 30% (`SOUL_DROP_CHANCE`) |
| 掉落数量 | 1（该花品种的魂） |

收割时按概率掉落，掉落时播放特效。魂是升级对应品种花朵的材料。

---

## 7. 玩家等级

| 等级 | 累计 XP | 解锁花朵 |
|------|---------|---------|
| 1 | 0 | 玫瑰、郁金香、雏菊 |
| 2 | 20 | 向日葵、薰衣草 |
| 3 | 50 | 兰花、牡丹 |
| 4 | 100 | 康乃馨、菊花 |
| 5 | 200 | 扶桑 |
| 6 | 350 | — |
| 7 | 550 | — |
| 8 | 800 | — |
| 9 | 1,100 | — |
| 10 | 1,500 | — |

**最高等级**：10

### 7.1 经验获取

| 来源 | XP 数量 |
|------|---------|
| 每次收割 | 5 (`XP_PER_HARVEST`) |
| 完成采购任务 | 动态（花朵总价值 × 0.5，至少 1） |

升级时播放升级特效动画。

---

## 8. 经济系统

### 8.1 采购任务

**入口**：工具栏 🛒 按钮打开面板

| 参数 | 值 |
|------|------|
| 任务数量 | 5 个（随机生成） |
| 每个任务需求花朵品种数 | 1~3 种 |
| 每种花需求数量 | 1~4 朵 |
| 奖励金币 | `花朵总价值 × 1.5` |
| 奖励经验 | `花朵总价值 × 0.5`（至少 1） |
| 完成后冷却 | 60 秒 |
| 可刷新 | 是（刷新按钮重新随机生成） |

**流程**：查看任务所需花朵 → 库存足够时点击"交付" → 扣除花朵 → 获得金币 + XP → 进入冷却

任务名从预设列表轮换：花束订单、花艺委托、鲜花配送、节庆花篮、花园装饰。

### 8.2 收购订单

**入口**：工具栏 🛍️ 按钮打开面板

| 参数 | 值 |
|------|------|
| 最大同时存在 | 3 个 (`BUY_ORDER_MAX_SLOTS`) |
| 生成间隔 | 45 秒 |
| 首次生成延迟 | 10 秒 |
| 订单有效期 | 60 秒（倒计时显示） |
| 收购数量 | 3~10 朵（随机一种花） |
| 单价倍率 | 花朵基础售价 × 1.5~2.5 |
| 过期处理 | 自动移除 |

**流程**：查看订单（花种 + 数量 + 总价） → 库存足够时点击"出售" → 扣除花朵 → 获得金币

收购订单不给经验，但单价较高（1.5x~2.5x），适合快速变现。

---

## 9. 仓库系统

**入口**：工具栏 📦 按钮打开面板（角标显示总库存数）

- 显示每种花朵的库存数量
- 花朵来源：收割入库
- 花朵消耗：采购任务交付、收购订单出售

---

## 10. 花盆皮肤

**入口**：工具栏 🪴 按钮打开面板

| 皮肤 | ID | 解锁费用 |
|------|------|---------|
| 经典赤陶 | `default` | 免费（默认拥有） |
| 青花瓷盆 | `ceramic_blue` | 500 金币 |

- 皮肤为全局生效，切换后所有花盆统一外观
- 已解锁的皮肤可自由切换

---

## 11. 个人中心

**入口**：工具栏 👤 按钮打开面板

**显示信息**：
- 玩家等级、当前经验 / 下一级所需
- 金币数、水量 / 上限
- 花朵库存总数
- 花卉之魂总数

**存档管理**：
- 「💾 立即保存」按钮
- 「🗑️ 删除存档」按钮（需二次确认，确认后清除 localStorage 并刷新页面重置游戏）
- 显示上次存档时间

---

## 12. 存档系统

| 参数 | 值 |
|------|------|
| 存储方式 | `localStorage` |
| 存储 Key | `flowers_game_save` |
| 自动保存间隔 | 5 秒 |
| 页面关闭时保存 | 是（`beforeunload`） |
| 页面切到后台保存 | 是（`visibilitychange`） |
| 存档版本号 | 1 |

**持久化数据**：
- 金币 + 水量（Currency）
- 花朵库存（Inventory）
- 花朵等级（FlowerLevels）
- 花卉之魂（FlowerSouls）
- 玩家等级 + XP（PlayerLevelState）
- 全部花盆状态（PotData[]）
- 当前皮肤 + 已解锁皮肤列表

**不持久化的数据**（每次打开重新生成）：
- 采购任务列表（随机重新生成）
- 收购订单（定时器重新生成）
- 特效队列
- UI 面板开关状态

---

## 13. 特效系统

游戏中有 8 种视觉特效：

| 特效类型 | 触发时机 | 说明 |
|---------|---------|------|
| `seed` | 播种时 | 种子落入动画 |
| `water` | 浇水时 | 水滴动画 |
| `harvest` | 收割时 | 收获飘散动画 |
| `levelup` | 花朵升级时 | 升级光效 |
| `task` | 完成采购/收购时 | ✓ 弹出 + 金币飘字 |
| `xpgain` | 获得经验时 | +XP 飘字 |
| `souldrop` | 掉落花卉之魂时 | 魂掉落动画 |
| `playerlevelup` | 玩家升级时 | 等级提升庆祝动画 |

特效为独立队列管理，播放完毕自动移除。

---

## 14. 交互方式

### 14.1 点击操作

- 点击空花盆 → 弹出种子选择面板
- 点击已播种花盆 → 弹出浇水面板
- 点击开花花盆 → 弹出收割面板

### 14.2 拖拽操作

支持触摸拖拽（移动端优化）：

| 参数 | 值 |
|------|------|
| 拖拽判定阈值 | 8px (`DRAG_THRESHOLD_PX`) |

拖拽时显示拖拽指示器（DragIndicator），松手在花盆上方时执行对应操作。区分 tap（点击）和 drag（拖拽）行为。

---

## 15. UI 布局

从上到下：

1. **CurrencyBar** — 金币 + 水量（含水量恢复倒计时）
2. **PlayerLevelBar** — 玩家等级 + 经验进度条
3. **Toolbar** — 工具栏按钮：📦 仓库 | 🛒 采购 | 🛍️ 收购 | ⬆️ 升级 | 🪴 皮肤 | 👤 个人
4. **Garden** — 4×7 花盆网格（可滚动）
5. **Hint** — 底部操作提示文字

### 15.1 弹出面板

以下面板均为全屏遮罩 + 居中弹窗形式：

- **FlowerPicker** — 种子选择
- **WaterPicker** — 浇水确认
- **HarvestPicker** — 收割确认
- **InventoryPanel** — 仓库
- **PurchasePanel** — 采购任务
- **BuyOrderPanel** — 收购订单
- **FlowerLevelPanel** — 花朵升级
- **PotSkinPanel** — 花盆皮肤
- **ProfileMenu** — 个人中心 + 存档管理

---

## 16. 代码架构

```
src/
├── config/                  # 纯数据配置层
│   ├── game.config.ts       # 全局数值（网格、货币、订单、皮肤等）
│   ├── flower.config.ts     # 花朵品种 + 等级 + 玩家等级配置
│   ├── task.config.ts       # 采购任务生成逻辑
│   └── index.ts             # 统一导出
├── types/
│   └── index.ts             # 所有 TypeScript 类型定义
├── hooks/                   # 状态管理层（11 个领域 Hook + 1 胶水层）
│   ├── useGameState.ts      # 胶水层：组装所有子 Hook + 依赖注入
│   ├── useCurrency.ts       # 金币 + 水量（含 ref 同步模式）
│   ├── useInventory.ts      # 花朵库存（含 ref 同步模式）
│   ├── useFlowerLevels.ts   # 花朵等级升级
│   ├── useFlowerSouls.ts    # 花卉之魂（含 ref 同步模式）
│   ├── usePlayerLevel.ts    # 玩家经验 + 等级
│   ├── usePots.ts           # 花盆状态 + 种/浇/收操作
│   ├── usePickers.ts        # Picker 面板显隐控制
│   ├── useBuyOrder.ts       # 收购订单（定时生成 + 过期清除）
│   ├── usePurchaseTasks.ts  # 采购任务（含冷却时间）
│   ├── usePotSkins.ts       # 花盆皮肤
│   ├── useCooldown.ts       # 花盆冷却倒计时扫描
│   ├── useEffects.ts        # 特效队列管理
│   └── useSaveGame.ts       # 存档系统（自动保存 + 读取 + 清除）
├── components/              # UI 组件层
│   ├── GameScene.tsx         # 游戏主场景（组装所有面板 + 状态）
│   ├── PotGrid.tsx           # 花盆网格
│   ├── Pot.tsx               # 单个花盆
│   ├── Toolbar.tsx           # 底部工具栏
│   ├── CurrencyBar.tsx       # 货币栏
│   ├── PlayerLevelBar.tsx    # 玩家等级栏
│   ├── FlowerPicker.tsx      # 种子选择面板
│   ├── WaterPicker.tsx       # 浇水面板
│   ├── HarvestPicker.tsx     # 收割面板
│   ├── InventoryPanel.tsx    # 仓库面板
│   ├── PurchasePanel.tsx     # 采购任务面板
│   ├── BuyOrderPanel.tsx     # 收购订单面板
│   ├── FlowerLevelPanel.tsx  # 花朵升级面板
│   ├── PotSkinPanel.tsx      # 花盆皮肤面板
│   ├── ProfileMenu.tsx       # 个人中心面板
│   ├── DragIndicator.tsx     # 拖拽指示器
│   ├── HarvestEffect.tsx     # 收割特效
│   ├── SeedEffect.tsx        # 播种特效
│   ├── WaterEffect.tsx       # 浇水特效
│   ├── LevelUpEffect.tsx     # 升级特效
│   ├── TaskCompleteEffect.tsx # 任务完成特效
│   ├── XpGainEffect.tsx      # 经验获取特效
│   ├── SoulDropEffect.tsx    # 花魂掉落特效
│   └── PlayerLevelUpEffect.tsx # 玩家升级特效
└── data/
    ├── assets.ts             # 资源路径映射
    └── flowers.ts            # 花朵数据（兼容旧引用）
```

### 16.1 关键设计模式

- **Ref 同步模式**：`useCurrency`、`useInventory`、`useFlowerSouls` 使用 `useRef` 跟踪最新状态，确保在 React 18 concurrent mode 下同步读取/扣除操作的返回值可靠
- **胶水层模式**：`useGameState` 不含业务逻辑，仅负责组装 11 个子 Hook 并注入依赖
- **配置层分离**：所有可调数值集中在 `config/` 目录，方便调整平衡性
